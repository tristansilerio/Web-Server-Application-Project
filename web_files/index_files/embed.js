new function($){var toggleQuestionState=function(enable){var invisible=this.attr("data-invisible")=="1",disabled=this.attr("data-disabled")=="1";invisible||disabled?invisible&&!disabled?this.enable(enable):!invisible&&disabled&&this.show(enable):this.showAndEnable(enable)};$.fn.extend({toggleQuestion:function(enable){var hiddenBySectionCondition=!1;this.attr("data-hidden-by-condition",enable?null:"1");enable&&this.hasClass("form_question")&&this.closest(".form_page[data-hidden-by-condition]").length>0?(this.attr("data-hidden-by-section-condition","1").showAndEnable(!1),hiddenBySectionCondition=!0):this.attr("data-hidden-by-section-condition")=="1"&&this.attr("data-hidden-by-section-condition",null);hiddenBySectionCondition||toggleQuestionState.call(this,enable);enable&&this.hasClass("form_page")&&(this.children('.form_question[data-hidden-by-section-condition = "1"]').attr("data-hidden-by-section-condition",null).each(function(){toggleQuestionState.call($(this),enable)}),this.children('.form_question[data-hidden-by-condition = "1"]').each(function(){toggleQuestionState.call($(this),!1)}));this.find(":input").triggerHandler("field_status_change")}});window.FormFiller=function(el){var _this=this,form=el,inited=!1,fields={},serverLogicFunctions=[],initialLogicExecution=!1,readOnlyStyle={border:"1px solid #cccccc",color:"#666666"},init=function(){var qs,i,q,rs,rs2;if(inited!=!0){inited=!0;el.width()<=480&&form.addClass("form_width_narrow");qs=form.find(".form_question");form.find("a.address_copy").on("click",function(){return copyAddress(this),!1});for(i=0;i<qs.length;i++){if(q=qs.eq(i),rs=q.find("input[type=checkbox],input[type=radio],input[type=text],input[type=email],input[type=tel],input[type=file],select,textarea"),q.data("disabled")=="1")rs.prop("disabled",!0).attr("data-disabled","1").css(readOnlyStyle);else if(q.data("readonly")=="1"){rs.prop("readOnly",!0).css(readOnlyStyle).on("change",change);rs2=q.find("input[type=checkbox],input[type=radio],input[type=file],select");rs2.length>0&&(rs2.prop("disabled",!0).attr("data-disabled","1"),rs2.each(function(){var rs2el=$(this),opts,i;rs2el.prop("tagName")=="SELECT"&&rs2el.prop("multiple")?(opts=rs2el.find("option:selected"),i=0,opts.each(function(){var opt=$(this);i++;$('<input type="hidden" />').attr("name",rs2el.attr("name")).attr("id",rs2el.attr("id")+"_"+i.toString()+"_hidden").attr("value",opt.attr("value")).insertBefore(rs2el)})):($('<input type="hidden" />').attr("name",rs2el.attr("name")).attr("id",rs2el.attr("id")+"_hidden").insertBefore(rs2el),rs2el.on("change",function(){var id=$(this).prop("id")+"_hidden",rshf=$(document.getElementById(id)),text;rshf.val($(this).val());text=$(this).text();$(this).is("select")&&(text=$(this).find("option:selected").text());rshf.attr("data-text",text);$(this).is("input[type=checkbox],input[type=radio]")&&($(this).prop("checked")?rshf.prop("disabled",!1):rshf.prop("disabled",!0).attr("data-disabled","1"))}).triggerHandler("change"))}))}else{rs.on("click",change).on("keyup",change).on("change",change);q.data("required")=="1"&&rs.attr("required","required")}fields[q.data("export")==null?q.data("id"):q.data("export")]=q.data("id")}form.trigger("ready")}},replicate=function(el){var template,destination,newNumber,template_html,form_id,form,scripts,i;el=$(el);template=el.parents("tbody").prevAll("tbody.replicate_template").eq(0);destination=el.closest("tbody");template.data("count")==null&&template.data("count",0);newNumber=template.data("count")+1;template.data("count",newNumber);template_html=$('<tbody class="replicate_destination" data-replicate_id="'+newNumber+'" />').append($(template.html().replace(/_ID_/g,newNumber.toString())));template_html.enable();template_html.find(".replicate_delete").on("click",function(){return replicate_delete(this),!1});for(template_html.insertBefore(destination),form||(form_id=$(el).closest("form").find("[name='id']").val()||$(el).closest("form").find("[id^='form_page_']").has(".form_pages").attr("id").replace("form_page_",""),form=window["form_"+form_id]),scripts=template_html.find(".x-script"),i=0;i<scripts.length;i++)eval(scripts.eq(i).text());template_html.find(".form_question").each(function(){var textel=$(this).find("input[type=checkbox],input[type=radio],input[type=text],input[type=email],input[type=tel],input[type=file],select,textarea");if(textel.data("readonly")!="1"&&textel.data("disabled")!="1")textel.on("click",change).on("keyup",change).on("change",change)});_this.initializeCalculatedFields(template_html);el.closest("form").find("[data-formula*='@*']").trigger("recalculate");replicate_renumber(el.closest("table"));form.getForm().trigger("replicate")},replicate_renumber=function(el){var tbodies,i,template,limit;for(el=$(el),tbodies=el.find("tbody.replicate_destination"),i=0;i<tbodies.length;i++)tbodies.eq(i).find(".replicate_number").text((i+1).toString());template=el.find("tbody.replicate_template").eq(0);limit=template.data("limit");limit!=null&&(limit=parseFloat(limit),el.find("tbody.replicate_insert_container").show(tbodies.length<limit))},replicate_delete=function(el){if(!confirm("Are you sure that you want to delete this entry?"))return!1;el=$(el);var table=el.parents("table").eq(0);return el.parents("tbody").eq(0).remove(),table.closest("form").find("[data-formula*='@*']").trigger("recalculate"),replicate_renumber(table),!1},initializePayments=function(){$(".payment_question",form).each(function(){var payment_question=$(this).val();payment_question!=null&&FW.Require([$("#"+payment_question+"_script",form).val()],function(){var mode=$("#"+payment_question+"_mode",form).val();if($("#"+payment_question+"_amount",form).addClass("payment_amount").on("change",function(){var amt=$("#"+payment_question+"_amount",form).val(),currency=$("#"+payment_question+"_currency",form).val(),displayAmount=$.formatNumber(amt,{format:"$#,##0.00",locale:"us"});currency!="USD"&&(displayAmount=$.formatNumber(amt,{format:"#,##0.00",locale:"us"})+" "+currency);$("#payment_display_"+payment_question,form).html(displayAmount);$("#"+payment_question+"_summary",form).val("Payment Due: "+$.formatNumber(amt,{format:"0.00",locale:"us"})+" "+currency);mode!="calculate"&&($("#due",form).val(amt).triggerHandler("change"),$(".displayAmount",form).html(displayAmount),$("#originalAmount",form).val(amt),$("input[name='card']:checked",form).length>0&&payment_select($("input[name='card']:checked",form).val()))}).trigger("change"),mode.includes("stripe"))form.closest("form").on("submit",function(){if($(".displayAmount:visible",form).length!==0&&!$("#paypal_order_no",form).val()){if(form.data("token_set")==1&&$("#payment_token",form).val()){$("input.payment_amount",form).trigger("recalculate");$("#name_section",form).showAndEnable(!1);form.closest("form").fireNext();return}return payment_verify()?sendDataToStripe(function(response){response.error?(alert(response.error.message),FW.Progress.Unload()):($("#payment_token",form).val(response.token.id),$("#"+payment_question+"_mode",form).val("stripe"),$("input.payment_amount",form).trigger("recalculate"),form.closest("form").fireNext())}):FW.Progress.Unload(),!1}});if(mode.includes("paypal")&&$("#paypal_client_id",form).val()){$("#stripe_display,#make_recurring, #name_section",form).showAndEnable(!1);$("#selected_card",form).append("<input type='radio' class='pay_type' name='card' value='PP' checked='checked' />");var buttonHtml="<tbody><tr><th colspan='2' style='background-color:#fff;'><div id='payment_choices'>",hasCard=$("#type_CC",form).length>0,hasCheck=$("#type_CK",form).length>0;hasCard&&(buttonHtml+="<button class='stripe_button' type='button' id='stripe_cc'>Credit Card<\/button>");hasCheck&&(buttonHtml+="<button class='stripe_button' type='button' id='stripe_ach'>Bank Account<\/button>");buttonHtml+="<button id='clear_paymentmethod_button'>Clear<\/button>";buttonHtml+="<div id='paypal-button-container'><\/div><\/div><\/th><\/tr><\/tbody>";$("#amount_display",form).after(buttonHtml);$("button.stripe_button",form).on("click",function(){$("#stripe_display, #make_recurring, #name_section",form).showAndEnable(!0);$("#method_row",form).showAndEnable(!1);$(this).prop("id")=="stripe_cc"?($("#block_0",form).showAndEnable(!0),$("#block_4",form).showAndEnable(!1),$("#type_CC",form).prop("checked",!0).triggerHandler("click")):($("#block_4",form).showAndEnable(!0),$("#block_0",form).showAndEnable(!1),$("#type_CK",form).prop("checked",!0).triggerHandler("click"));$("button.stripe_button",form).removeClass("selected");$(this).parent().addClass("payment_selected");$(this).addClass("selected")});$("button#clear_paymentmethod_button",form).on("click",function(){$("button.stripe_button",form).removeClass("selected");$("#type_CC",form).prop("checked",!1).triggerHandler("click");$("#type_CK",form).prop("checked",!1).triggerHandler("click");$("#block_4",form).showAndEnable(!1);$("#block_0",form).showAndEnable(!1);$(this).parent().removeClass("payment_selected")});FW.Require(["js:https://www.paypal.com/sdk/js?disable-funding=card,credit&enable-funding=venmo&intent=capture&client-id="+$("#paypal_client_id",form).val()+"&merchant-id="+$("#paypal_merchant_id",form).val()],function(){paypal.Buttons({style:{layout:FW.isMobile()?"vertical":"horizontal",tagline:"false",color:"white"},onInit:function(data,actions){$("#"+payment_question+"_amount",form).on("change",function(){var amt=$("#"+payment_question+"_amount",form).val();!amt||parseFloat(amt)<=0?actions.disable():actions.enable()}).triggerHandler("change")},createOrder:function(data,actions){return $("#stripe_display,#make_recurring,#name_section",form).showAndEnable(!1),$("button.stripe_button",form).removeClass("selected").removeClass("not_selected"),actions.order.create({purchase_units:[{amount:{value:$("#"+payment_question+"_amount",form).val()}}],intent:"CAPTURE"})},onApprove:function(data){$("#paypal_order_no",form).val(data.orderID);$("#"+payment_question+"_mode",form).val("paypal");$("#"+payment_question+"_amount",form).data("calc-final",$("#"+payment_question+"_amount",form).val());$("#payment_choices",form).after("<div id='paypal_message'>Your payment information has been authorized and the payment will complete after clicking Submit.<\/div>")}}).render("#paypal-button-container")})}if(mode=="calculate")form.closest("form").on("submit",function(){$("input.payment_amount",form).trigger("recalculate")})})})},copyAddress,change;this.ready=function(){initializePayments()};this.prefillCardInformation=function(token,cardType,cardLast4,cardExp){form.closest("form").data("card").destroy();$("#type_CC",form).prop("checked",!0).triggerHandler("click");$("#payment_token",form).val(token);$("#card-location",form).parent().html("Captured credit card: "+cardType+" ending in "+cardLast4+", expiring "+cardExp);$("#name_section",form).showAndEnable(!1);form.data("token_set",1)};this.filterArray=function(array,filterByArray){var arrayOut,i;for($.isArray(filterByArray)||(filterByArray=[filterByArray]),arrayOut=[],i=0;i<array.length;i++)filterByArray.indexOf(array[i])>-1&&arrayOut.push(array[i]);return arrayOut};this.appendServerLogic=function(event){serverLogicFunctions.push(event)};this.initializeReplicates=function(){$(".replicate_template",form).each(function(){var template=$(this),template_table,minlength,template_count,x,el,template_html,scripts,i;template.disable();template_table=template.closest("table");template_table.find(".replicate_insert").on("click",function(){return replicate(this),!1});template_table.find(".replicate_delete").on("click",function(){return replicate_delete(this),!1});if(minlength=template.data("minlength"),minlength>0)for(template_count=template.data("count"),x=1;x<=minlength;x++){if(el=$(".replicate_insert",template_table),el.length>0&&x>template_count)replicate(el);else{for(template_html=$(template.html().replace(/_ID_/g,x.toString())),scripts=template_html.find(".x-script"),i=0;i<scripts.length;i++)eval(scripts.eq(i).text());el.closest("form").find("[data-formula*='@*']").trigger("recalculate")}x<=minlength&&$(".replicate_destination",template_table).eq(x-1).find(".replicate_delete").remove()}})};this.initializeLogic=function(){initialLogicExecution=!0;for(var i=0;i<serverLogicFunctions.length;i++)serverLogicFunctions[i]();form.find('.form_responses:has([data-handler-change="1"])').each(function(){$(this).find("[data-handler-change]:eq(0)").triggerHandler("change")});form.find('.form_responses [data-bubbling="1"]').attr("data-bubbling",null);form.find(".form_loading:eq(0)").hide();form.find(".form_pages:eq(0)").show();$(".form_action").show();initialLogicExecution=!1};this.getForm=function(){return form};this.getItem=function(selectorPrefix,selectorSuffix,args){for(var el2,el=null,i=0;i<args.length;i++)el2=form.find(selectorPrefix+FW.escapeSelector(args[i])+selectorSuffix),el=el==null?el2:el.add(el2);return el==null&&(el=$([])),el};this.getSection=function(){return this.getItem('.form_page[data-export="','"]',arguments)};this.getSectionById=function(){return this.getItem('.form_page[data-id="','"]',arguments)};this.getQuestion=function(){return this.getItem('.form_question[data-export="','"]',arguments)};this.getQuestionById=function(){return this.getItem('.form_question[data-id="','"]',arguments)};this.getFieldTypeById=function(){return this.getItem('.form_question[data-id="','"]',arguments).data("type")};this.getFieldDataTypeById=function(){return this.getItem('.form_question[data-id="','"]',arguments).data("datatype")};this.getElementById=function(){var item=this.getItem('[name^="form_','"]',arguments);return item&&item.length!=0||(item=this.getQuestionById(arguments[0]).find("[name]")),item};this.getElement=function(){var item=this.getItem('[name^="form_','"]',$.map(arguments,function(arr){return fields[arr]}));return item&&item.length!=0||(item=this.getQuestion(arguments[0]).find("[name]")),item};this.getValueById=function(id){var type=this.getFieldTypeById(id),dataType=this.getFieldDataTypeById(id),val=this.getValueArrayById(id);return val.length==0?null:type=="birthdate"||type=="date"||type=="calendar"||dataType=="int"||dataType=="real"||dataType=="date"||dataType=="datetime"?val[0]:val.join(",")};this.getValue=function(key,container){var val=this.getValueArray(key,container);return val.length==0?null:val.length==1?val[0]:val.join(",")};this.getText=function(key){var val=this.getTextArray(key);return val.length==0?null:val.length==1?val[0]:val.join(",")};this.getLocalDate=function(date){return new Date(date.getTime()+date.getTimezoneOffset()*6e4)};this.getValueArray=function(key,container){return this.getValueArrayById(fields[key],container)};this.getValueArrayForReplicate=function(key){var id=fields[key],suffix=null;id.indexOf("_")>=0&&(suffix=id.substr(id.indexOf("_")-1));id.indexOf("^")>=0&&(id=id.substr(0,id.indexOf("^")));var selector="[name^='form_"+id+"']",allFields=$(selector),currFrm=this;return $.map(allFields,function(item){var currId=item.id;return currId=currId.replace("form_",""),currFrm.getValueById(currId)})};this.getTextArray=function(key){return this.getTextArrayById(fields[key])};this.getTextArrayById=function(id){return this.getValueArrayByIdValue(id,"text")};this.getValueArrayById=function(id){return this.getValueArrayByIdValue(id,"value")};this.getValueArrayByIdValue=function(id,valuetype,container){var type,dataType,val2,field_val,address,val,self;if(container||(container=form),type=this.getFieldTypeById(id),dataType=this.getFieldDataTypeById(id),dataType||(dataType="text"),val2=[],type=="date"||type=="birthdate"){field_val="";container.find('[name="form_'+id+'"]:enabled').val()?field_val=container.find('[name="form_'+id+'"]:enabled').val():container.find('[name="form_'+id+'_y"]:enabled').val()&&container.find('[name="form_'+id+'_m"]:enabled').val()&&container.find('[name="form_'+id+'_d"]:enabled').val()&&(field_val+=container.find('[name="form_'+id+'_y"]:enabled').val()+"-"+container.find('[name="form_'+id+'_m"]:enabled').val()+"-"+container.find('[name="form_'+id+'_d"]:enabled').val());try{field_val=this.getLocalDate(new Date(field_val))}catch(ex){}val2.push(field_val)}else if(type=="dateym"){field_val="";container.find('[name="form_'+id+'"]:enabled').val()?field_val=container.find('[name="form_'+id+'"]:enabled').val():container.find('[name="form_'+id+'_y"]:enabled').val()&&container.find('[name="form_'+id+'_m"]:enabled').val()&&(field_val+=container.find('[name="form_'+id+'_y"]:enabled').val()+"-"+container.find('[name="form_'+id+'_m"]:enabled').val()+"-01");try{field_val=this.getLocalDate(new Date(field_val))}catch(ex){}val2.push(field_val)}else if(type=="datemd"){field_val="";container.find('[name="form_'+id+'"]:enabled').val()?field_val=container.find('[name="form_'+id+'"]:enabled').val():container.find('[name="form_'+id+'_m"]:enabled').val()&&container.find('[name="form_'+id+'_d"]:enabled').val()&&(field_val+=(new Date).getFullYear().toString()+"-"+container.find('[name="form_'+id+'_m"]:enabled').val()+"-"+container.find('[name="form_'+id+'_d"]:enabled').val());try{field_val=this.getLocalDate(new Date(field_val))}catch(ex){}val2.push(field_val)}else type=="address"?(address={},address.street=container.find('[name="form_'+id+'_street"]:enabled').val(),address.region=container.find('[name="form_'+id+'_region"]:enabled').val(),address.country=container.find('[name="form_'+id+'_country"]:enabled').val(),address.city=container.find('[name="form_'+id+'_city"]:enabled').val(),address.postal=container.find('[name="form_'+id+'_postal"]:enabled').val(),val2.push(address)):(val=container.find('[name="form_'+id+'"]:enabled'),val.length==0&&(val=this.getQuestionById(id).find("[name]:enabled")),val.length>0&&(val=val.filter("input[type=checkbox]:checked,input[type=radio]:checked,input[type=text],input[type=hidden],input[type=email],input[type=tel],textarea,select"),val.is("select")&&(val=val.find("option:selected")),self=this,val.each(function(){var field_val=valuetype=="text"?$(this).attr("data-text"):$(this).val();if((dataType=="int"||dataType=="real")&&(field_val=field_val.replace(/[^\d.-]/g,"")),dataType=="int")field_val=parseInt(field_val,10);else if(dataType=="real")field_val=parseFloat(field_val);else if(type=="calendar"||dataType=="date"||dataType=="datetime")try{field_val=self.getLocalDate(new Date(field_val))}catch(ex){}val2.push(field_val)})));return val2};this.getValueForCalculation=function(key,replicateId){var question=null,val,selected,newval;if(question=replicateId?form.find('[data-replicate_id="'+replicateId+'"] .form_question[data-export="'+FW.escapeSelector(key)+'"]'):this.getQuestion(key),question.length>1&&question.has(":input:enabled").length>0&&(question=question.has(":input:enabled")),val=0,$.inArray(question.data("datatype"),["int","real"])>=0&&$.inArray(question.data("type"),["select","checkbox","radio","likert","text","selectable"])>=0){switch(question.data("type")){case"select":val=question.find("option:selected").val();val&&val.length>10&&(val=question.find("option:selected").text());break;case"checkbox":case"selectable":case"radio":selected=question.find("input:checked");val=selected.val();val&&val.length>10&&(val=question.find("label[for="+selected.prop("id")+"]").text());break;case"likert":selected=question.find("input:checked");val=selected.val();val&&val.length>10&&(val=selected.data("label"));break;case"text":val=question.find(":input").val()}if(val&&(val=val.replace(/[^\d.-]/g,"")),question.data("datatype")=="int")val=parseInt(val,10);else if(question.data("datatype")=="real")val=parseFloat(val);else if(question.data("datatype")=="date"||question.data("datatype")=="datetime")try{newval=self.getLocalDate(new Date(val));val=newval}catch(ex){}}else val=replicateId?this.getValue(key,form.find('[data-replicate_id="'+replicateId+'"]')):this.getValue(key);return question.has(":input:enabled").length==0&&question.attr("data-hidden-by-condition")=="1"?typeof val=="number"?0:null:typeof val=="number"&&isNaN(val)?0:val};this.setValue=function(key,value){var val=form.find('[name="form_'+fields[key]+'"]'),nodes=val.filter("input[type=text],input[type=email],input[type=tel],textarea"),i;if(nodes.length==1){nodes.val(value);return}for(nodes=val.filter("input[type=checkbox],input[type=radio],select"),nodes.is("select")&&(nodes=nodes.find("option")),i=0;i<nodes.length;i++)nodes.eq(i).val()==value&&(nodes.eq(i).prop("nodeName")=="OPTION"?nodes.eq(i).prop("selected",!0):nodes.eq(i).prop("checked",!0))};this.addCountdown=function(key,count,isWords){var el=this.getElement(key),helpName,countConfig;isWords||el.attr("maxlength",count);helpName=key.replace(/[ :]/g,"_");countConfig="{ help: '#"+helpName+"_maxlength'";countConfig+=isWords?", words: "+count+" }":" }";el.attr("data-maxlength",countConfig);el.after("<div id='"+helpName+"_maxlength' style='text-align: right; color: inherit; width:370px;'>"+count+" "+(isWords?"words":"characters")+" remaining<\/div>")};this.addCharacterCountdown=function(key,charCount){this.addCountdown(key,charCount,!1)};this.addWordCountdown=function(key,wordCount){this.addCountdown(key,wordCount,!0)};copyAddress=function(el){el=$(el);$(".form_responses",$("#form_question_"+el.data("id"))).children().each(function(){if($(this).prop("id")){var copyfromfield=$("#"+$(this).prop("id").replace(el.data("id"),el.data("copy")));copyfromfield.length>0&&$(this).val(copyfromfield.val())}})};change=function(event){var self=$(this),el=self.parents("div.form_question").eq(0),el2,type,field,country,hasFile,hasText,mask;if(el.hasClass("required")){if(el2=el.find(".form_responses"),type=el.data("type"),type=="text"||type=="email"||type=="tel"){if(el2.find("input").val()=="")return}else if(type=="textarea"){if(el2.find("textarea").val()=="")return}else if(type=="select"||type=="multiselect"){if(el2.find("select").val()=="")return}else if(type=="checkbox"||type=="radio"||type=="likert"){if(el2.find("input:checked").length==0)return}else if(type=="birthdate"||type=="date"){if(field=el2.find("select"),field.eq(0).val()==""||field.eq(1).val()==""||field.eq(2).val()=="")return}else if(type=="dateym"||type=="datemd"){if(field=el2.find("select"),field.eq(0).val()==""||field.eq(1).val()=="")return}else if(type=="address"){if(country=el2.find("select:last").val(),el2.find("textarea").val()==""||el2.find("input[type=text]").eq(0).val()=="")return;if(country=="US"&&field==null&&(field=el2.find("select:visible").eq(0),field.val()==""))return}else if(type=="location"){if(el2.find("input[type=text]").eq(0).val()=="")return}else if(type=="plugin:event"){if(el2.find("input:checked").length==0)return}else if(type=="plugin:material"){if(hasFile=el2.find("input[type=file]").eq(0).val(),hasText=el2.find("textarea").eq(0).val(),!(hasText||hasFile))return}else return;el.removeClass("required");el.find('[aria-invalid = "true"]').attr("aria-invalid","false")}self.is("input")&&event.type=="change"&&(mask=el.data("mask"),mask!=null&&mask.length>0&&FW.ValidateMask(self,mask))};this.Validate=function(silent){for(var country,hasFile,files,f,hasText,mask,req_hit,val,result,req_el=null,req_count=0,mask_count=0,reqs=null,reqs=form.find('.form_question[data-required = "1"],.form_question[data-mask]'),i=0;i<reqs.length;i++){var el=reqs.eq(i),el2=el.find(".form_responses"),field=null,type=el.data("type");if((el2.find("input:enabled:visible,select:enabled:visible,textarea:enabled:visible").length!=0||type=="selectable")&&(type!="selectable"||el2.find("input:enabled").length!=0)){if(el.data("required")==1){if(req_hit=!0,type=="text"||type=="email"||type=="tel")field=el2.find("input"),field.val()!=""&&(req_hit=!1);else if(type=="textarea")field=el2.find("textarea"),field.val()!=""&&(req_hit=!1);else if(type=="select"||type=="multiselect")field=el2.find("select"),field.val()!=""&&el2.find("select").prop("selectedIndex")>-1&&(req_hit=!1);else if(type=="checkbox"||type=="radio"||type=="likert"||type=="selectable")el2.find("input:checked").length>0&&(req_hit=!1),field=el2.find("input").eq(0);else if(type=="birthdate"||type=="date")field=el2.find("select"),field.eq(0).val()!=""&&field.eq(1).val()!=""&&field.eq(2).val()!=""&&(req_hit=!1);else if(type=="dateym"||type=="datemd")field=el2.find("select"),field.eq(0).val()!=""&&field.eq(1).val()!=""&&(req_hit=!1);else if(type=="address")field=el2.find("textarea"),field.val()!=""&&(field=null),field==null&&(field=el2.find("input[type=text]").eq(0),field.val()!=""&&(field=null)),country=el2.find("select:last").val(),country=="US"&&field==null&&(field=el2.find("select:visible").eq(0),field.val()!=""&&(field=null)),field==null&&(req_hit=!1);else if(type=="location"||type=="location_nopostal")field=el2.find("input[type=text]").eq(0),field.val()!=""&&(req_hit=!1);else if(type=="plugin:event")field=el2.find("input[type=checkbox]").eq(0),el2.find("input:checked").length>0&&(req_hit=!1);else if(type=="plugin:material")if(el2.find('[data-validate-fulfilled="1"]').length>0)req_hit=!1;else{if(field=el2.find("input[type=file]"),hasFile=field.eq(0).val(),hasFile)for(files=field.get(0).files,f=0;f<files.length;f++)files[f].size==0&&(hasFile=null);hasText=el2.find("textarea").eq(0).val();(hasText||hasFile)&&(req_hit=!1)}else req_hit=!1;req_hit==!0&&(req_count++,el.addClass("required"),field.attr("aria-invalid","true"),req_el==null&&(req_el=field))}el.data("mask")!=null&&(mask=el.data("mask"),mask!=""&&(req_hit=!0,el.hasClass("form_text")?(field=el2.find("input"),val=field.val(),val==""?req_hit=!1:(result=FW.ValidateMask(field,mask),result==!0&&(req_hit=!1))):req_hit=!1,req_hit==!0&&(mask_count++,el.addClass("required"),field.attr("aria-invalid","true"),req_el==null&&(req_el=field))))}}return req_el==null?!0:silent==!0?!1:(FW.Dialog.Load($('<div class="dialog" style="width: 400px;"><div style="padding: 50px 25px;"><div role="alert" style="color: #cc0000; text-align: center; font-weight: bold;">'+(req_count==0?"":req_count.toString()+" required field"+(req_count==1?" was":"s were")+" not completed")+(req_count==0||mask_count==0?"":" and ")+(mask_count==0?"":mask_count.toString()+" field"+(mask_count==1?" was":"s were")+" not properly formatted")+".<\/div><\/div><\/div>"),{stack:!0}),window.setTimeout(function(){FW.Dialog.Unload();var el=req_el.parents(".form_question").eq(0),scroller=el.getVerticalScroller();scroller==null?req_el.focus():scroller.animate({scrollTop:scroller.prop("nodeName")=="HTML"||scroller.prop("nodeName")=="BODY"?el.offset().top-25:el.position().top-25+scroller.scrollTop()},500,function(){req_el.focus()})},2500),!1)};this.Submit=function(){return this.Validate()?(FW.Postback(form),!0):!1};this.applyConditionalLogicRecursive=function(el){el=$(el);el.find('.form_responses:has([data-handler-change="1"])').each(function(){var el2=$(this).find("[data-handler-change]:eq(0)");el2.attr("data-bubbling")!="1"&&(el2.attr("data-bubbling","1"),el2.triggerHandler("change"))});initialLogicExecution||window.setTimeout(function(){el.find('[data-bubbling="1"]').attr("data-bubbling",null)},25)};this.applyConditionalPrompts=function(field){var fieldConditions,choicesToShow,filteredChoices,showQuestion,optionsToShow,possibleOptions;if(!(form.find(".form_pages.readOnly").length>0)&&(fieldConditions=$.grep(this.conditionalPromptConfig,function(item){return item.field==field}),fieldConditions!=null&&fieldConditions.length!=0)){fieldConditions=fieldConditions[0];choicesToShow=[];filteredChoices=[];$.each(fieldConditions.conditions,function(i,item){item.condition(_this)&&$.merge(choicesToShow,item.prompts);$.merge(filteredChoices,item.prompts)});var targetQuestion=this.getQuestionById(field),targetType=targetQuestion.data("type"),targetInput=targetType=="selectable"?"checkbox":targetType,target=this.getElementById(field);if(target.data("stack")!=!0){target.data("stack",!0);showQuestion=!1;switch(targetType){case"select":case"multiselect":optionsToShow=target.find("option").filter(function(){return $.inArray(this.value,choicesToShow)>=0});possibleOptions=target.find("option").filter(function(){return $.inArray(this.value,filteredChoices)>=0});optionsToShow.showOption();possibleOptions.not(optionsToShow).hideOption();target.hideOptionGroups();showQuestion=target.children("option:not(:empty)").add(target.children("optgroup").children("option:not(:empty)")).length>0;break;case"checkbox":case"radio":case"selectable":optionsToShow=target.filter(function(){return $.inArray(this.value,choicesToShow)>=0});possibleOptions=target.filter(function(){return $.inArray(this.value,filteredChoices)>=0});optionsToShow.parent().showAndEnable(!0);possibleOptions.not(optionsToShow).parent().showAndEnable(!1);showQuestion=targetQuestion.attr("data-hidden-by-condition")!="1"&&targetQuestion.find(":"+targetInput+":enabled").length>0}target.triggerHandler("change");showQuestion&&(targetQuestion.attr("data-hidden-by-condition")!="1"||targetQuestion.attr("data-hidden-by-conditional-prompts")=="1")?(targetQuestion.attr("data-hidden-by-conditional-prompts","0"),targetQuestion.show(!0)):showQuestion||(targetQuestion.attr("data-hidden-by-condition")!="1"&&targetQuestion.attr("data-hidden-by-conditional-prompts","1"),targetQuestion.show(!1));target.data("stack",!1)}}};this.getAllExportLabels=function(){var elements=form.find("[data-export]"),exports=elements.map(function(){return $(this).data("export").toString()}).get();return exports.sort(function(a,b){return b.length-a.length})};this.initializeCalculatedFields=function(context){context==null&&(context=form.find("div.form_page[data-replicate!='1']"));var exportLabels=this.getAllExportLabels(),calculatedFields=context.find("[data-formula]"),frm=this;calculatedFields.each(function(i,item){frm.initializeCalculatedField(item,exportLabels,context)})};this.getExecutableFormula=function(formula,exports,driverFields,replicateDriverFields,replicateId){return typeof formula=="string"&&(formula.indexOf("translate(")>=0&&(formula=formula.replace(/translate\(/g,"frm.translate(")),formula.indexOf("sum(")>=0&&(formula=formula.replace(/sum\(/g,"frm.sum(")),formula.indexOf("count(")>=0&&(formula=formula.replace(/count\(/g,"frm.count(")),formula.indexOf("countWhere(")>=0&&(formula=formula.replace(/countWhere\(/g,"frm.countWhere("))),$.each(exports,function(i,exp){typeof formula=="string"&&(formula.indexOf("@"+exp)>=0&&(driverFields.push(exp),formula.indexOf("@"+exp+"_textlist")>=0&&(formula=formula.replace(new RegExp("@"+FW.escapeRegEx(exp+"_textlist"),"gi")," frm.getTextArray('"+exp+"') ")),formula.indexOf("@"+exp+"_text")>=0&&(formula=formula.replace(new RegExp("@"+FW.escapeRegEx(exp+"_text"),"gi")," frm.getText('"+exp+"') ")),formula.indexOf("@"+exp+"_exact")>=0&&(formula=formula.replace(new RegExp("@"+FW.escapeRegEx(exp+"_exact"),"gi")," frm.getValue('"+exp+"') ")),formula.indexOf("@"+exp+"_list")>=0&&(formula=formula.replace(new RegExp("@"+FW.escapeRegEx(exp+"_list"),"gi")," frm.getValueArray('"+exp+"') ")),formula.indexOf("@"+exp)>=0&&(formula=formula.replace(new RegExp("@"+FW.escapeRegEx(exp),"gi")," frm.getValueForCalculation('"+exp+"'"+(replicateId?" ,"+replicateId:"")+" ) "))),formula.indexOf("@*"+exp)>=0&&(replicateDriverFields.push(exp),formula.indexOf("@*"+exp)>=0&&(formula=formula.replace(new RegExp("@"+FW.escapeRegEx("*"+exp),"gi")," frm.getValueArrayForReplicate('"+exp+"') "))))}),formula};this.initializeCalculatedField=function(fld,exports,context){var replicateId=context.data("replicate_id"),frm=this,driverFields=[],replicateDriverFields=[],originalFormula=$(fld).data("formula"),formula=originalFormula,calcHandler;formula=this.getExecutableFormula(formula,exports,driverFields,replicateDriverFields,replicateId);calcHandler=function(){var self=$(this),result;if(self.data("calc-stack")!="1"){self.data("calc-stack","1");try{if(result=eval(formula),typeof result!="number"||!isNaN(result)){if($(fld).data("calc-final")&&result!=$(fld).data("calc-final"))throw new Error("Calculated value is locked");$(fld).val(result).trigger("change")}}catch(ex){alert("The following error occurred:\n"+ex.toString()+"\n\nwhile evaluating the formula:\n"+originalFormula)}self.data("calc-stack",null)}};$(function(){$.each(driverFields,function(i,drv){context.find(".form_question[data-export='"+FW.escapeSelector(drv)+"'] .form_responses :input").on("change",calcHandler).on("field_status_change",calcHandler)});$.each(replicateDriverFields,function(i,drv){var id=fields[drv];id.indexOf("^")>=0&&(id=id.substr(0,id.indexOf("^")));frm.getForm().on("change",'[name^="form_'+id+'"]',calcHandler).on("field_status_change",'[name^="form_'+id+'"]',calcHandler)});$(fld).on("recalculate",calcHandler).on("field_status_change",calcHandler);calcHandler()})};this.sum=function(values){var total=0;return $.each(values,function(i,item){isNaN(item)||(total+=Number(item))}),total};this.count=function(values){var count=0;return $.each(values,function(i,item){item&&(count+=1)}),count};this.countWhere=function(values,target){var count=0;return $.each(values,function(i,item){item==target&&(count+=1)}),count};this.translate=function(translatorName,value){var translation;if(!this.translators||!this.translators[translatorName])return"";var translator=this.translators[translatorName],found=!1,result="";return translator.type=="int"&&(value=parseInt(value)),translator.type=="real"&&(value=parseFloat(value)),translation=$.grep(translator.translations,function(item){return translator.type=="string"?item.minValue==value:item.minValue<=value&&value<=item.maxValue}),translation&&translation.length>0&&(found=!0,result=translation[0].export),!found&&translator.default&&(result=translator.default),translator.resultType=="int"&&(result=parseInt(result)),translator.resultType=="real"&&(result=parseFloat(result)),(translator.resultType=="int"||translator.resultType=="real")&&isNaN(result)&&(result=0),result};this.initializeFieldLimits=function(){var frm=this,limitedFields=form.find("[data-limit]");limitedFields.each(function(i,item){frm.initializeFieldLimit(item)})};this.initializeFieldLimit=function(fld){var type,limit;if(fld=$(fld),type=fld.data("type"),type=="checkbox"||type=="plugin:event"||type=="selectable"){limit=fld.data("limit");fld.find(":checkbox").on("change",function(){var numChecked=fld.find(":checkbox:checked").length;$(this).is(":checked")&&numChecked>parseInt(limit)&&(limit=="1"?fld.find(":checkbox:checked").not(this).prop("checked",!1):$(this).prop("checked",!1))})}};this.initializeCapacityCheck=function(domain,response){if(!(form.closest("form").find('.error[data-waitlist = "1"]').length>0)){var frm=this,timeout=null,initialTime=Date.now(),checkInProgress=!1,checkCapacity=function(){var formId,events,data,keepChecking;if(!checkInProgress){if(checkInProgress=!0,timeout&&(window.clearTimeout(timeout),timeout=null),formId=form.closest("form:visible").find('[name = "id"]').val(),!document.hidden&&formId!=null&&!$(document.body).hasClass("progress")){events=[];events.push(formId);$(".form_response > [data-event]").each(function(){events.push($(this).data("event"))});var attendees=0,registrants=1,register_block=$('[name = "register_replicate"]');register_block.length>0&&(registrants=register_block.closest("div.form_page").find(".replicate_destination").length);attendees=frm.getElement("sys:guests").length>0?registrants+(Number(frm.getValue("sys:guests"))||0):frm.getElement("sys:attendees").length>0?registrants-1+(Number(frm.getValue("sys:attendees"))||0):registrants;data={cmd:"fetch",ids:events.join(","),attendees:attendees,registrants:registrants};response&&(data.response=response);$.ajax({type:"POST",url:domain+"/register/form?cmd=counts&id="+formId,data:data,dataType:"json",success:function(result){$.each(result.results.results,function(i,item){if(item.id==formId)item.exceed=="1"&&(FW.Dialog.Load($('<div class="dialog" style="width: 400px;"><div class="content" style="padding: 50px 25px;"><div role="alert" style="color: #cc0000; text-align: center; font-weight: bold;">'+result.message+'<\/div><\/div><div class="action"><button class="default" onclick="FW.Dialog.Unload();" type="button">Close<\/button><\/div><\/div>')),window.clearTimeout(timeout));else{var rel_evt=$("[data-event='"+item.id+"']").closest("div.form_response");item.exceed=="1"?(rel_evt.addClass("full").find(":input").disable().addClass("disabled_full"),rel_evt.find("span.full_message").show()):(rel_evt.removeClass("full").find(":input.disabled_full").enable(),rel_evt.find("span.full_message").hide())}})},error:function(xhr,status,error){console.log(status,error)},complete:function(){checkInProgress=!1}})}keepChecking=Date.now()-initialTime<9e5;keepChecking&&(timeout=window.setTimeout(checkCapacity,15e3))}};checkCapacity();frm.getElement("sys:guests").on("change",checkCapacity);frm.getElement("sys:attendees").on("change",checkCapacity);if(frm.getForm().find('[name = "register_replicate"]').length>0)frm.getForm().on("replicate",checkCapacity)}};init()}}(FW.$);